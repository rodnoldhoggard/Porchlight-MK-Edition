<!DOCTYPE html>
<html>
<head>
    <title>PORCHLIGHT</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; }
        
        /* Universal Menu Style */
        .overlay-screen { 
            position: absolute; width: 100%; height: 100%; 
            display: flex; flex-direction: column; justify-content: center; 
            align-items: center; background: radial-gradient(circle, #222 0%, #000 100%);
            z-index: 10; color: white; text-align: center;
        }

        h1 { font-size: 100px; letter-spacing: 15px; margin: 0; color: #fff; text-shadow: 0 0 30px #fff; }
        
        /* Mortal Kombat Elements */
        .mk-text { 
            font-size: 120px; color: #ff0000; text-shadow: 5px 5px #440000; 
            font-style: italic; display: none; animation: slam 0.3s ease-out;
        }

        @keyframes slam {
            0% { transform: scale(5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        #fatality-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: red; opacity: 0; pointer-events: none; z-index: 20;
        }

        .start-btn { 
            margin-top: 50px; padding: 10px 50px; font-size: 20px; 
            background: transparent; color: white; border: 2px solid white; 
            cursor: pointer; transition: 0.3s;
        }
        .start-btn:hover { background: #ff0000; border-color: #ff0000; }

        #ui { position: absolute; top: 20px; left: 20px; color: white; display: none; font-weight: bold; z-index: 5; }
    </style>
</head>
<body>

    <div id="fatality-overlay"></div>

    <div id="menu" class="overlay-screen">
        <h1>PORCHLIGHT</h1>
        <button class="start-btn" onclick="startGame()">ENTER THE VOID</button>
    </div>

    <div id="win-screen" class="overlay-screen" style="display:none;">
        <h1 class="mk-text" id="win-text" style="display:block;">YOU WIN</h1>
        <p style="font-size: 30px; color: #fff; margin-top: 20px;">FLAWLESS VICTORY</p>
        <button class="start-btn" onclick="location.reload()">REPLAY</button>
    </div>

    <div id="ui">LEVEL: <span id="lvl-count">1</span> / 10</div>
    
    <script type="module">
        import * as THREE from 'https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.module.min.js';

        let gameActive = false;
        let currentLevel = 1;
        let shakeIntensity = 0;
        const obstacles = [];
        const overlay = document.getElementById('fatality-overlay');

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const pLight = new THREE.PointLight(0xffffff, 80, 100);
        scene.add(pLight);
        scene.add(new THREE.AmbientLight(0xffffff, 0.2));

        const player = new THREE.Mesh(new THREE.BoxGeometry(0.7,0.7,0.7), new THREE.MeshStandardMaterial({color: 0xffffff}));
        scene.add(player);

        const goal = new THREE.Mesh(new THREE.SphereGeometry(0.5), new THREE.MeshStandardMaterial({color: 0xffd700, emissive: 0xffd700}));
        scene.add(goal);

        window.startGame = function() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('ui').style.display = 'block';
            gameActive = true;
            loadLevel(1);
        };

        // --- FATALITY SYSTEM ---
        function triggerFatality() {
            shakeIntensity = 0.8; 
            overlay.style.opacity = '1'; 
            setTimeout(() => { overlay.style.opacity = '0'; }, 200);
            loadLevel(1); // Reset to start
        }

        function loadLevel(num) {
            if (num > 10) {
                gameActive = false;
                document.getElementById('ui').style.display = 'none';
                document.getElementById('win-screen').style.display = 'flex';
                return;
            }
            currentLevel = num;
            document.getElementById('lvl-count').innerText = num;
            player.position.set(0, 0, 0);
            goal.position.set(0, 0, -num * 12);
            
            obstacles.forEach(o => scene.remove(o));
            obstacles.length = 0;

            for(let i=0; i < num * 6; i++) {
                const obs = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 2), new THREE.MeshStandardMaterial({color: 0x880000}));
                obs.position.set(Math.random() * 14 - 7, 0, -Math.random() * (num * 12) - 3);
                scene.add(obs);
                obstacles.push(obs);
            });obstacles.push(obs); } }